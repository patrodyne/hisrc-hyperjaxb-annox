# Sample: Resourced Bindings

This is a Maven project to demonstrate the *removal* of **JAXB** annotations from **XJC** classes combined with the *addition* of [HiSrc BasicJAXB Annox][3] resource files to preserve a **JAXB** context. Further, it includes examples of optional **XJC** plugins to add custom `hashCode`, `equals`, `toString` and `copyable` implementations to each generated **JAXB** class.

> **Note:** Examples of **JAXB** annotations are: `@XmlAccessorType`,  `@XmlType`, `@XmlElement` and `@XmlAttribute`, etc. 

## Execution

This is a stand-alone Maven project. You can run the test(s) and/or the demonstration using:

~~~
mvn -Ptest clean test
mvn -Pexec compile exec:java
~~~

This [output][22] shows the test results.

### Problem ( from [StackOverflow][1] )

Use **XSD** and **XJB** files to generate POJO(s) without **JAXB** annotations inside their code.

+ Remove **JAXB** annotations from **XJC** generated classes.
+ Add equivalent **JAXB** bindings as [HiSrc BasicJAXB Annox][3] resource files.

> **Note:** [HiSrc BasicJAXB Annox][3] resource file(s) are **XML** file(s) that parallel their POJO(s) on the classpath by substituting a `.ann.xml` suffix on their file name. [These resource files][4] use [annox.xsd][5] definitions to configure a **JAXB** context.

### Solution

To [demonstrate (zip)][6] a solution, [this][23] Maven project uses the [hisrc-higherjaxb-maven-plugin][7] to generate **JAXB** classes with annotations; then, it uses the `XremoveAnnotation` plugin from [HiSrc HyperJAXB Annox][2] to remove the annotations.

The **JAXB** classes are generated by this plugin using this project's [pom.xml][21]

~~~
<plugin>
    <groupId>org.patrodyne.jvnet</groupId>
    <artifactId>hisrc-higherjaxb-maven-plugin</artifactId>
    <version>${hisrc-higherjaxb-maven-plugin.version}</version>
    <executions>
        <execution>
            <goals>
                <goal>generate</goal>
            </goals>
            <configuration>
                <args>
                    <arg>-no-header</arg>
                    <arg>-XhashCode</arg>
                    <arg>-Xequals</arg>
                    <arg>-XtoString</arg>
                    <arg>-Xcopyable</arg>
                    <arg>-XremoveAnnotation</arg>
                </args>
                <plugins>
                    <plugin>
                        <groupId>org.patrodyne.jvnet</groupId>
                        <artifactId>hisrc-basicjaxb-plugins</artifactId>
                        <version>${hisrc-basicjaxb.version}</version>
                    </plugin>
                    <plugin>
                        <groupId>org.patrodyne.jvnet</groupId>
                        <artifactId>hisrc-hyperjaxb-annox-plugin</artifactId>
                        <version>${hisrc-hyperjaxb-annox-plugin.version}</version>
                    </plugin>
                </plugins>
            </configuration>
        </execution>
    </executions>
</plugin>
~~~

and are generated to this target folder *without* annotations:

~~~
target/generated-sources/xjc
├── META-INF
│   └── sun-jaxb.episode
└── org
    └── example
        └── po
            ├── Item.java
            ├── Items.java
            ├── ObjectFactory.java
            ├── package-info.java
            ├── PurchaseOrder.java
            └── USAddress.java
~~~

These **JAXB** Java classes are generated from XML Schema file(s) and Binding file(s) using its **XJC** compiler.

The selective removal of **JAXB** annotations is configured in the [XJB][30] file, here's a snippet:

**PurchaseOrder.xjb**
~~~
...
<!-- Items -->
<jaxb:bindings node="xsd:complexType[@name='Items']">
    <annox:removeAnnotation target="class" class="jakarta.xml.bind.annotation.XmlAccessorType"/>
    <annox:removeAnnotation target="class" class="jakarta.xml.bind.annotation.XmlType"/>
</jaxb:bindings>
...
~~~

The `removeAnnotation` element declares the `target` scope and the `class` (annotation), to be removed, for the annotations bound to the `Items` type, for this demonstration

The `target` attribute accepts these scopes: `"package"`, `"class"`, `"getter"`, `"setter"`, `"field"`, `"setter-parameter"`, `"enum"`, `"enum-constant"`, `"enum-value-method"`, `"enum-fromValue-method"`, and `"element"`.

Next, the [Main][25] and [PurchaseOrderTest][33] classes each create a `JAXBContext` with an `AnnoxAnnotationReader` to read [`ann.xml`][4] resource files and rebind the annotations in memory. Thus, the generated **JAXB** become *Plain Java Objects (POJOs)* while the context is provided in memory.

**JAXBContext plus AnnoxAnnotationReader**
~~~
RuntimeAnnotationReader annotationReader = new AnnoxAnnotationReader();
Map<String, Object> properties = new HashMap<>();
properties.put(JAXBRIContext.ANNOTATION_READER, annotationReader);
Class<?>[] classes = { ObjectFactory.class };
setJaxbContext(JAXBContext.newInstance(classes, properties));
~~~

This project, named [resourced][23], uses a standard Maven layout. This project includes:

+ A JAXB *binding* file [PurchaseOrder.xjb][30] for configuration
+ An XML Schema file [PurchaseOrder.xsd][31] for the `PurchaseOrder` model
+ An XML Sample file [po.xml][36] for unmarshalling
+ A JUnit test class [PurchaseOrderTest.java][33] to verify (un)marshalling
+ A [Main][25] class to demonstrate a simple use case.
+ The Maven [POM][25] file with `hisrc-higherjaxb-maven-plugin`
+ **Plus**, [HiSrc BasicJAXB Annox][3] resource files: [\*.ann.xml][4]

~~~
resourced
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   │   └── org
    │   │       └── example
    │   │           └── po
    │   │               └── Main.java
    │   └── resources
    │       ├── org
    │       │   └── example
    │       │       └── po
    │       │           ├── Item.ann.xml
    │       │           ├── Items.ann.xml
    │       │           ├── PurchaseOrder.ann.xml
    │       │           └── USAddress.ann.xml
    │       ├── PurchaseOrder.xjb
    │       ├── PurchaseOrder.xsd
    │       └── simplelogger.properties
    └── test
        ├── java
        │   └── org
        │       └── example
        │           └── po
        │               └── PurchaseOrderTest.java
        ├── resources
        │   ├── jvmsystem.arguments
        │   └── jvmsystem.properties
        └── samples
            └── po.xml
~~~

#### Execution

This is a stand-alone Maven project. You can run the test(s) and/or application using:

~~~
mvn -Ptest clean test
mvn -Pexec compile exec:java
~~~

##### Approach

The [hisrc-higherjaxb-maven-plugin][7] is configured to generate **JAXB** classes using the provided [PurchaseOrder.xsd][31] schema. The schema provides the namespace `"http://example.org/po"` which **JAXB** uses to create the Java `package` name using its own naming convention.

As an option, a more advanced implementation of Java's built-in `Object` methods are generated using these **XJC** [hisrc-basicjaxb-plugins][8]. In particular, the sample project uses the `toString` plugin to display *human-readable* representations of the unmarshaled `PurchaseOrder` objects.

**hisrc-basicjaxb-plugins**
~~~
<args>
    <arg>-no-header</arg>
    <arg>-XhashCode</arg>
    <arg>-Xequals</arg>
    <arg>-XtoString</arg>
    <arg>-Xcopyable</arg>
    ...
</args>
~~~

> *Note:* When the **XJC** [hisrc-basicjaxb-plugins][8] are used, the [hisrc-basicjaxb-runtime][8] dependency is required on the run-time class path.

Finally, the `XremoveAnnotation` plugin is enabled to process the directives in the [PurchaseOrder.xjb][30] binding file and remove the JAXB annotations, as intended.

**hisrc-hyperjaxb-annox-plugin**
~~~
<args>
    ...
    <arg>-XremoveAnnotation</arg>
</args>
~~~

##### Testing

The JUnit test class, [PurchaseOrderTest.java][33], scans for the sample files and invokes the method `checkSample(File sample)` to provide each file to the tester. For this project, a `JAXBContext` is created and each file in the [samples][37] path is *unmarshaled* to a `PurchaseOrder` object. When successful, each object is *marshaled* for logging and your [review][22].

##### Demonstration

A Java standard engine application with a `main(...)` method is at [`org.example.po.Main`][25]. This application is executed using:

~~~
mvn -Pexec compile exec:java -Dexec.args="src/test/samples/po.xml"
~~~

#### JVM Compatibility

> The source/target (release) compatibility for the above is at Java 11, up from Java 8. And, JDK 17 is used for the build. JAXB dependencies are at version 4.x for [Jakarta EE 10][15]. The [4.x][11] release of the JAXB [API][12], [RI][13] and [ZIP][16] uses the latest [JAXB Schema Binding 3.0 Specification][14].

<!-- References -->

[1]: https://stackoverflow.com/questions/76095099/
[2]: https://github.com/patrodyne/hisrc-hyperjaxb-annox#readme
[3]: https://github.com/patrodyne/hisrc-basicjaxb-annox#readme
[4]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/org/example/po/
[5]: https://github.com/patrodyne/hisrc-basicjaxb-annox/blob/master/core/src/main/resources/annox.xsd
[6]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/releases/download/2.1.0/hisrc-hyperjaxb-annox-sample-resourced-2.1.0-mvn-src.zip
[7]: https://github.com/patrodyne/hisrc-higherjaxb#readme
[8]: https://github.com/patrodyne/hisrc-basicjaxb#readme
[10]: https://jakarta.ee/specifications/xml-binding/
[11]: https://jakarta.ee/specifications/xml-binding/4.0/
[12]: https://github.com/jakartaee/jaxb-api/tree/4.0.0-RELEASE
[13]: https://github.com/eclipse-ee4j/jaxb-ri/tree/4.0.2-RI-RELEASE/jaxb-ri
[14]: https://jakarta.ee/xml/ns/jaxb/bindingschema_3_0.xsd
[15]: https://projects.eclipse.org/projects/ee4j.jaxb-impl/releases/4.0.0
[16]: https://repo1.maven.org/maven2/com/sun/xml/bind/jaxb-ri/4.0.2/
[20]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/pom.xml
[21]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/project-pom.xml
[22]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/OUTPUT.txt
[23]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/README.md
[24]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/bin/run.sh
[25]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/java/org/example/po/Main.java
[26]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/org/example/po/Item.ann.xml
[27]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/org/example/po/Items.ann.xml
[28]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/org/example/po/PurchaseOrder.ann.xml
[29]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/org/example/po/USAddress.ann.xml
[30]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/PurchaseOrder.xjb
[31]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/PurchaseOrder.xsd
[32]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/main/resources/simplelogger.properties
[33]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/test/java/org/example/po/PurchaseOrderTest.java
[34]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/test/resources/jvmsystem.arguments
[35]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/test/resources/jvmsystem.properties
[36]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/test/samples/po.xml
[37]: https://github.com/patrodyne/hisrc-hyperjaxb-annox/blob/master/assembly/samples/resourced/src/test/samples/
